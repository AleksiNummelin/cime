<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5. Building a Case &mdash; CIME 5.4.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CIME 5.4.0 documentation" href="../index.html" />
    <link rel="up" title="Case Control System Part 1: Basic Usage" href="index.html" />
    <link rel="next" title="6. Running a Case" href="running-a-case.html" />
    <link rel="prev" title="4. Setting up a Case" href="setting-up-a-case.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="running-a-case.html" title="6. Running a Case"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="setting-up-a-case.html" title="4. Setting up a Case"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.4.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Case Control System Part 1: Basic Usage</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-a-case">
<span id="id1"></span><h1>5. Building a Case<a class="headerlink" href="#building-a-case" title="Permalink to this headline">¶</a></h1>
<p>The following describes the process of building the model executable.</p>
<div class="section" id="calling-case-build">
<span id="building-the-model"></span><h2>5.1. Calling <strong>case.build</strong><a class="headerlink" href="#calling-case-build" title="Permalink to this headline">¶</a></h2>
<p>After calling <strong>case.setup</strong>, run <strong>case.build</strong> to build the model executable. Running this will:</p>
<ol class="arabic simple">
<li>Create the component namelists in <code class="docutils literal"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal"><span class="pre">$CASEROOT/CaseDocs</span></code>.</li>
<li>Create the necessary compiled libraries <code class="docutils literal"><span class="pre">mct</span></code>, <code class="docutils literal"><span class="pre">pio</span></code>, <code class="docutils literal"><span class="pre">gptl</span></code> and <code class="docutils literal"><span class="pre">csm_share</span></code>.
The libraries will be placed in a path below <code class="docutils literal"><span class="pre">$SHAREDLIBROOT</span></code>.</li>
<li>Create the necessary compiled libraries. These are be placed in <code class="docutils literal"><span class="pre">$EXEROOT/bld/lib</span></code>.</li>
<li>Create the model executable (<code class="docutils literal"><span class="pre">$MODEL.exe</span></code>), which is placed in <code class="docutils literal"><span class="pre">$EXEROOT</span></code>.</li>
</ol>
<p>You do not need to change the default build settings to create the executable, but it is useful to become familiar with them in order to make optimal use of the system. The CIME scripts provide you with a great deal of flexibility in customizing the build process.</p>
<p>The <strong>env_build.xml</strong> variables control various aspects of building the executable. Most of the variables should not be modified, but users can modify these:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">$BUILD_THREADED</span></code></li>
<li><code class="docutils literal"><span class="pre">$DEBUG</span></code></li>
<li><code class="docutils literal"><span class="pre">$GMAKE_J</span></code></li>
</ul>
<p>The best way to see what xml variables are in your <code class="docutils literal"><span class="pre">$CASEROOT</span></code> directory is to use the <strong>xmlquery</strong> command. For usage information, run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">xmlquery</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>To build the model, change to your <code class="docutils literal"><span class="pre">$CASEROOT</span></code> directory and execute <strong>case.build</strong>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd $CASEROOT
&gt; ./case.build
</pre></div>
</div>
<p>Diagnostic comments appear as the build proceeds.</p>
<p>The <strong>case.build</strong> command generates the utility and component libraries and the model executable, and it generates build logs for each component. Each log file is named form: <strong>$component.bldlog.$datestamp</strong>. They are located in <code class="docutils literal"><span class="pre">$BLDDIR</span></code>. If they are compressed (as indicated by a .gz file extension), the build ran successfully.</p>
<p>Invoking <strong>case.build</strong> creates the following directory structure in <code class="docutils literal"><span class="pre">$EXEROOT</span></code> if the Intel compiler is used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">atm</span><span class="o">/</span><span class="p">,</span> <span class="n">cpl</span><span class="o">/</span><span class="p">,</span> <span class="n">esp</span><span class="o">/</span><span class="p">,</span> <span class="n">glc</span><span class="o">/</span><span class="p">,</span> <span class="n">ice</span><span class="o">/</span><span class="p">,</span> <span class="n">intel</span><span class="o">/</span><span class="p">,</span> <span class="n">lib</span><span class="o">/</span><span class="p">,</span> <span class="n">lnd</span><span class="o">/</span><span class="p">,</span> <span class="n">ocn</span><span class="o">/</span><span class="p">,</span> <span class="n">rof</span><span class="o">/</span><span class="p">,</span> <span class="n">wav</span><span class="o">/</span>
</pre></div>
</div>
<p>Except for <strong>intel/</strong> and <strong>lib/</strong>, each directory contains an <strong>obj/</strong> subdirectory for the target model component&#8217;s compiled object files.</p>
<p>The <em>mct</em>, <em>pio</em>, <em>gptl</em> and <em>csm_share</em> libraries are placed in a directory tree that reflects their dependencies. See the <strong>bldlog</strong> for a given component to locate the library.</p>
<p>Special <strong>include</strong> modules are placed in <strong>lib/include</strong>. The model executable (<strong>cesm.exe</strong> or <strong>e3sm.exe</strong>, for example) is placed directly in <code class="docutils literal"><span class="pre">$EXEROOT</span></code>.</p>
<p>Component namelists, component logs, output data sets, and restart files are placed in <code class="docutils literal"><span class="pre">$RUNDIR</span></code>.
It is important to note that <code class="docutils literal"><span class="pre">$RUNDIR</span></code> and <code class="docutils literal"><span class="pre">$EXEROOT</span></code> are independent variables that are set in the <strong>$CASEROOT/env_run.xml</strong> file.</p>
</div>
<div class="section" id="rebuilding-the-model">
<span id="id2"></span><h2>5.2. Rebuilding the model<a class="headerlink" href="#rebuilding-the-model" title="Permalink to this headline">¶</a></h2>
<p>Rebuild the model under the following circumstances:</p>
<p>If either <strong>env_build.xml</strong> or <strong>Macros.make</strong> has been modified, and/or if code is added to <strong>SourceMods/src.</strong>, it&#8217;s safest to clean the build and rebuild from scratch as shown here:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd $CASEROOT
&gt; ./case.build --clean
</pre></div>
</div>
<p>If you have ONLY modified the PE layout in <strong>env_mach_pes.xml</strong>, a clean may not be required.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt; cd $CASEROOT
&gt; ./case.build
</pre></div>
</div>
<p>If the threading has been changed (turned on or off) in any component since the previous build, the build script should fail with the following error and suggestion that the model be rebuilt from scratch:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ERROR</span> <span class="n">SMP</span> <span class="n">STATUS</span> <span class="n">HAS</span> <span class="n">CHANGED</span>
<span class="n">SMP_BUILD</span> <span class="o">=</span> <span class="n">a0l0i0o0g0c0</span>
<span class="n">SMP_VALUE</span> <span class="o">=</span> <span class="n">a1l0i0o0g0c0</span>
<span class="n">A</span> <span class="n">manual</span> <span class="n">clean</span> <span class="n">of</span> <span class="n">your</span> <span class="n">obj</span> <span class="n">directories</span> <span class="ow">is</span> <span class="n">strongly</span> <span class="n">recommended</span><span class="o">.</span>
<span class="n">You</span> <span class="n">should</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
   <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span>
   <span class="o">./</span><span class="n">case</span><span class="o">.</span><span class="n">build</span>

 <span class="o">----</span> <span class="n">OR</span> <span class="o">----</span>

 <span class="n">You</span> <span class="n">can</span> <span class="n">override</span> <span class="n">this</span> <span class="n">error</span> <span class="n">message</span> <span class="n">at</span> <span class="n">your</span> <span class="n">own</span> <span class="n">risk</span> <span class="n">by</span> <span class="n">executing</span><span class="p">:</span>
   <span class="o">./</span><span class="n">xmlchange</span> <span class="n">SMP_BUILD</span><span class="o">=</span><span class="mi">0</span>
 <span class="n">Then</span> <span class="n">rerun</span> <span class="n">the</span> <span class="n">build</span> <span class="n">script</span> <span class="n">interactively</span><span class="o">.</span>
</pre></div>
</div>
<p>If there is any doubt, rebuild.</p>
<dl class="docutils">
<dt>Run this to clean all of the model components (except for support libraries such as <em>mct</em> and <em>gptl</em>):</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span>
</pre></div>
</div>
</dd>
<dt>Run this to clean everything associated with the build:</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span><span class="o">-</span><span class="nb">all</span>
</pre></div>
</div>
</dd>
<dt>You can also clean an individual component as shown here, where &#8220;compname&#8221; is the name of the component you want to clean (for example, atm, clm, pio and so on).</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">case</span><span class="o">.</span><span class="n">build</span> <span class="o">--</span><span class="n">clean</span> <span class="n">compname</span>
</pre></div>
</div>
</dd>
</dl>
<p>Review the <strong>help</strong> text for more information.</p>
</div>
<div class="section" id="input-data">
<span id="inputdata"></span><h2>5.3. Input data<a class="headerlink" href="#input-data" title="Permalink to this headline">¶</a></h2>
<p>All active components and data components use input data sets. In order to run CIME and the CIME-compliant active components, a local disk needs the directory tree that is specified by the xml variable <code class="docutils literal"><span class="pre">$DIN_LOC_ROOT</span></code> to be populated with input data.</p>
<p>Input data is provided as part of the CIME release via data from a subversion input data server. It is downloaded from the server on an as-needed basis determined by the case. Data may already exist in the default local file system&#8217;s input data area as specified by <code class="docutils literal"><span class="pre">$DIN_LOC_ROOT</span></code>.</p>
<p>Input data can occupy significant space on a system, so users should share a common <code class="docutils literal"><span class="pre">$DIN_LOC_ROOT</span></code> directory on each system if possible.</p>
<p>The build process handles input data as follows:</p>
<ul>
<li><p class="first">The <strong>buildnml</strong> scripts in the various component <strong>cime_config</strong> directories create listings of required component input data sets in the <strong>Buildconf/$component.input_data_list</strong> files.</p>
</li>
<li><p class="first"><strong>check_input_data</strong>, which is called by <strong>case.build</strong>, checks for the presence of the required input data files in the root directory <code class="docutils literal"><span class="pre">$DIN_LOC_ROOT</span></code>.</p>
</li>
<li><p class="first">If all required data sets are found on the local disk, the build can proceed.</p>
</li>
<li><p class="first">If any of the required input data sets are not found locally, the files that are missing are listed. At this point, you must obtain the required data from the input data server with <strong>check_input_data</strong> as shown here:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">check_input_data</span> <span class="o">--</span><span class="n">export</span>
</pre></div>
</div>
</li>
</ul>
<p>The <strong>env_run.xml</strong> variables <code class="docutils literal"><span class="pre">$DIN_LOC_ROOT</span></code> and <code class="docutils literal"><span class="pre">$DIN_LOC_ROOT_CLMFORC</span></code> determine where you should expect input data to reside on a local disk.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Building a Case</a><ul>
<li><a class="reference internal" href="#calling-case-build">5.1. Calling <strong>case.build</strong></a></li>
<li><a class="reference internal" href="#rebuilding-the-model">5.2. Rebuilding the model</a></li>
<li><a class="reference internal" href="#input-data">5.3. Input data</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="setting-up-a-case.html"
                        title="previous chapter">4. Setting up a Case</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="running-a-case.html"
                        title="next chapter">6. Running a Case</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/building-a-case.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="running-a-case.html" title="6. Running a Case"
             >next</a> |</li>
        <li class="right" >
          <a href="setting-up-a-case.html" title="4. Setting up a Case"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.4.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Case Control System Part 1: Basic Usage</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.3.
    </div>
  </body>
</html>