<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7. Timers and timing &mdash; CIME 5.4.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="CIME 5.4.0 documentation" href="../index.html" />
    <link rel="up" title="Case Control System Part 1: Basic Usage" href="index.html" />
    <link rel="next" title="8. Testing with create_test" href="testing.html" />
    <link rel="prev" title="6. Porting and validating CIME on a new platform" href="porting-cime.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="8. Testing with create_test"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="porting-cime.html" title="6. Porting and validating CIME on a new platform"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.4.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Case Control System Part 1: Basic Usage</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="timers-and-timing">
<span id="timers"></span><h1>7. Timers and timing<a class="headerlink" href="#timers-and-timing" title="Permalink to this headline">¶</a></h1>
<p>CIME includes a copy of the General Purpose Timing Library (GPTL) and timers are placed throughout the CIME driver.  CIME-driven models typically
also have GPTL timers in their code and very detailed timing information can be obtained.</p>
<div class="section" id="model-timing-data">
<span id="id1"></span><h2>7.1. Model timing data<a class="headerlink" href="#model-timing-data" title="Permalink to this headline">¶</a></h2>
<p>Every model run produces a summary timing output file. The file is placed in
<strong>$CASEROOT/timing/ccsm_timing.$CASE.$date</strong>, where $date is a datestamp that CIME sets at runtime.
The following describes the most important parts of a timing file:</p>
<ul class="simple">
<li>CCSM TIMING PROFILE is the first section in the timing output. It summarizes general timing information for the run. The total run time and cost are given in several metrics to facilitate analysis and comparisons with other runs. These metrics includ pe-hrs per simulated year (cost), simulated years per wall day (thoughput), seconds, and seconds per model day. The total run time for each component and the time for initialization of the model also are provided. These times are the aggregate over the total run and do not take into account any temporal or processor load imbalances.</li>
<li>DRIVER TIMING FLOWCHART is the second section in the timing output. It provides timing information for the driver in sequential order and indicates which processors are involved in the cost. Finally, the timings for the coupler are broken out at the bottom of the timing output file.</li>
<li>Another file in the timing directory, <strong>ccsm_timing_stats.$date</strong>, summarizes the minimum and maximum of all the model timers.</li>
<li>Another stream of useful timing information is the <strong>cpl.log.$date</strong> file that every run produces. It contains the run time for each model day during the run and is output during the run. You can search for <code class="docutils literal"><span class="pre">tStamp</span></code> in the cpl.log file to see the information, which is useful for tracking down temporal variability in cost due to inherent model variability or to hardware. The model daily cost generally is pretty constant unless I/O is written intermittently, such as at the end of the month.</li>
</ul>
</div>
<div class="section" id="controlling-timers">
<h2>7.2. Controlling timers<a class="headerlink" href="#controlling-timers" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add info on how to control timers</p>
</div>
</div>
<div class="section" id="setting-the-time-limits">
<h2>7.3. Setting the time limits<a class="headerlink" href="#setting-the-time-limits" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>When you look at the <strong>ccsm_timing.$CASE.$datestamp</strong> file for &#8220;Model Throughput&#8221;, you will find output like this:</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Overall</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="n">Model</span> <span class="n">Cost</span><span class="p">:</span> <span class="mf">327.14</span> <span class="n">pe</span><span class="o">-</span><span class="n">hrs</span><span class="o">/</span><span class="n">simulated_year</span> <span class="p">(</span><span class="n">scale</span><span class="o">=</span> <span class="mf">0.50</span><span class="p">)</span>
<span class="n">Model</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">4.70</span> <span class="n">simulated_years</span><span class="o">/</span><span class="n">day</span>
</pre></div>
</div>
</dd>
</dl>
<p>The model throughput is the estimated number of model years that you can run in a wallclock day. Based on this, you can maximize your <strong>$CASE.run</strong> queue limit and change <code class="docutils literal"><span class="pre">$STOP_OPTION</span></code> and <code class="docutils literal"><span class="pre">$STOP_N</span></code> in <strong>env_run.xml</strong>.</p>
<dl class="docutils">
<dt>For example, say a model&#8217;s throughput is 4.7 simulated_years/day, and the maximum runtime limit on your machine is 12 hours. 4.7 model years/24 hours * 12 hours = 2.35 years. On the massively parallel computers, there is always some variability in how long it will take a job to run. On some machines, you may need to leave as much as 20% buffer time in your run to guarantee that jobs finish reliably before the time limit. For that reason, set your model to run only one model year/job. In this example, set your wallclock at 12 hours and invoke <strong>xmlchange</strong> in <code class="docutils literal"><span class="pre">CASEROOT</span></code> as shown here:</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;./</span><span class="n">xmlchange</span> <span class="n">STOP_OPTION</span><span class="o">=</span><span class="n">nyears</span>
<span class="o">&gt;./</span><span class="n">xmlchange</span> <span class="n">STOP_N</span><span class="o">=</span><span class="mi">1</span>
<span class="o">&gt;./</span><span class="n">xmlchange</span> <span class="n">REST_OPTION</span><span class="o">=</span><span class="n">nyears</span>
<span class="o">&gt;./</span><span class="n">xmlchange</span> <span class="n">REST_N</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">7. Timers and timing</a><ul>
<li><a class="reference internal" href="#model-timing-data">7.1. Model timing data</a></li>
<li><a class="reference internal" href="#controlling-timers">7.2. Controlling timers</a></li>
<li><a class="reference internal" href="#setting-the-time-limits">7.3. Setting the time limits</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="porting-cime.html"
                        title="previous chapter">6. Porting and validating CIME on a new platform</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="testing.html"
                        title="next chapter">8. Testing with create_test</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/timers.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="8. Testing with create_test"
             >next</a> |</li>
        <li class="right" >
          <a href="porting-cime.html" title="6. Porting and validating CIME on a new platform"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CIME 5.4.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Case Control System Part 1: Basic Usage</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.3.
    </div>
  </body>
</html>